# DocuGenius 更新日志

## [2.3.5] - 2025-08-21

### 🎯 关键修复：图像位置插入问题

#### 核心问题彻底解决
- **图像位置错误**: 彻底修复了图像被放到文末"## Extracted Images"部分的问题
- **智能提取增强**: 为DOCX格式实现了完整的智能图像提取功能
- **回退机制优化**: 改进了传统模式的图像插入逻辑，避免生成"## Extracted Images"标题

#### 技术改进详情
- **DOCX智能提取**: 实现了完整的DOCX文档智能图像提取，图像插入到原文位置
- **PDF智能提取**: 继续使用高质量的PDF智能提取，保持图像位置准确性
- **传统模式优化**: 修复了回退到传统模式时图像仍被放到文末的问题
- **内联图像引用**: 使用内联模式替代分组模式，避免生成章节标题

#### 修复前后对比
**修复前** ❌:
```markdown
# Document Title

Some text content...

## Extracted Images

![Image 1](images/doc/img1.png)
![Image 2](images/doc/img2.png)
```

**修复后** ✅:
```markdown
# Document Title

![Image 1](images/doc/img1.png)

Some text content...

![Image 2](images/doc/img2.png)

More text content...
```

#### 支持格式扩展
- **PDF**: 完整的智能位置检测和插入 ✅
- **DOCX**: 新增智能图像提取和位置插入 ✅
- **PPTX**: 传统提取模式，内联插入 ✅
- **XLSX**: 传统提取模式，内联插入 ✅

---

## [2.3.4] - 2025-08-21

### 📁 重要修复：统一图像目录结构

#### 核心问题解决
- **目录不统一**: 修复了同时生成`images`和`assets`文件夹的问题
- **引用路径错误**: 修复了使用`文档名_assets`而不是统一`images`路径的问题
- **TypeScript与Python不一致**: 统一了前端和后端的图像存储逻辑

#### 技术改进
- **统一目录结构**: 所有图像现在统一保存到`DocuGenius/images/文档名/`
- **一致的引用格式**: 图像引用统一使用`images/文档名/图像文件名`格式
- **清理旧版本**: 自动清理遗留的`_assets`文件夹
- **跨平台一致性**: Mac和Windows版本使用相同的目录结构

#### 修复前后对比
**修复前**:
```
DocuGenius/
├── 文档名.md
├── 文档名_assets/          # 错误的assets目录
│   └── image.png
└── images/                 # 同时存在的images目录
    └── 文档名/
        └── image.png
```

**修复后**:
```
DocuGenius/
├── 文档名.md
└── images/                 # 统一的images目录
    └── 文档名/
        └── image.png
```

#### 引用格式统一
**修复前**: `![Image](文档名_assets/image.png)` ❌
**修复后**: `![Image](images/文档名/image.png)` ✅

---

## [2.3.3] - 2025-08-21

### 🖼️ 重大修复：图像插入和引用问题

#### 核心问题解决
- **图像位置错误**: 修复了图像没有插入到原文正确位置的问题
- **引用失效**: 修复了图像引用路径不正确，导致markdown中无法显示图像的问题
- **格式问题**: 修复了markdown格式化问题，确保换行符正确处理

#### 技术改进
- **智能位置检测**: 使用PyMuPDF的位置信息，将图像插入到文档中的原始位置
- **相对路径优化**: 改进了相对路径计算逻辑，确保markdown中的图像引用正确工作
- **文本块排序**: 按垂直位置对文本和图像元素进行排序，保持原始文档布局
- **换行符修复**: 修复了字符串中的转义换行符问题

#### 功能增强
- **位置感知提取**: 图像现在根据在PDF中的实际位置插入到markdown中
- **更好的Alt文本**: 图像alt文本包含页码和尺寸信息
- **错误处理**: 改进了图像处理失败时的错误处理和回退机制
- **格式一致性**: 确保生成的markdown格式正确，便于阅读和编辑

#### 用户体验改进
- **正确的图像显示**: 图像现在在markdown预览中正确显示
- **保持文档结构**: 转换后的文档保持原始的文本和图像布局
- **清晰的引用**: 图像引用包含有用的描述信息

---

## [2.3.2] - 2025-08-20

### 🔧 重要修复：恢复二进制文件方案

#### 问题解决
- **依赖安装问题**: 修复了shell脚本版本中的Python包安装失败问题
- **环境污染**: 避免了在多个项目中重复安装依赖包的问题
- **性能优化**: 恢复使用二进制文件，提供更好的启动性能

#### 技术改进
- **新的二进制构建**: 使用更新的build_binaries.py重新编译Mac版本
- **集成图像提取**: 二进制文件现在包含完整的图像提取功能
- **PyMuPDF集成**: 内置PyMuPDF库，支持高质量PDF图像提取
- **文件大小优化**: 新二进制文件37MB，包含所有必需依赖

#### 用户体验改进
- **零依赖**: 用户无需手动安装Python包
- **即开即用**: 下载插件后立即可用，无需额外配置
- **稳定性**: 避免了依赖版本冲突和环境问题

---

## [2.3.1] - 2025-08-20

### 🚀 重大更新：Mac版本功能对等

#### 新增功能
- **完整的图像提取功能**: Mac版本现在支持与Windows版本相同的智能图像提取
- **静态文档转换器**: 为Mac版本添加了完整的converter.py，支持所有文档格式
- **增强的CLI工具**: 使用shell脚本替代二进制文件，提供更好的维护性和用户体验

#### 改进内容
- **image_extractor.py**: 从439行扩展到831行，添加了完整的图像提取功能
  - 支持PDF、DOCX、PPTX、XLSX格式的智能图像提取
  - 实现了文档内容与图像的智能集成
  - 添加了相对路径计算、文件名生成等辅助功能
  - 支持最小图像大小过滤和多种提取模式

- **converter.py**: 新增247行的完整转换器
  - 与Windows版本功能对等
  - 集成了图像提取功能
  - 支持多种文档格式转换
  - 实现了跨平台兼容的编码处理

- **CLI工具**: 创建了功能完整的shell脚本
  - 自动依赖检测和安装
  - 保持向后兼容性（通过符号链接）
  - 详细的使用说明和错误处理
  - 智能Python版本检测

#### 技术改进
- **跨平台兼容性**: 移除了Windows特定的编码设置
- **依赖管理**: 实现了智能的Python包检测和安装
- **错误处理**: 添加了完善的错误处理和回退机制
- **文档结构**: 保持了与Windows版本一致的文件组织结构

#### 用户体验提升
- **透明的依赖管理**: 用户可以看到正在安装的依赖包
- **更好的错误诊断**: 提供清晰的错误信息和解决建议
- **自定义能力**: 高级用户可以根据需要修改脚本行为
- **快速问题解决**: 开发者可以快速推送脚本修复

### 📊 功能对比

| 功能 | Windows版本 | Mac版本（2.3.0） | Mac版本（2.3.1） |
|------|-------------|------------------|------------------|
| 图像提取 | ✅ 完整支持 | ❌ 功能有限 | ✅ 完整支持 |
| 文档转换 | ✅ 静态转换器 | ❌ 缺失 | ✅ 静态转换器 |
| CLI工具 | ✅ 批处理文件 | ❌ 旧版二进制 | ✅ Shell脚本 |
| 依赖管理 | ✅ 自动安装 | ❌ 手动安装 | ✅ 自动安装 |
| 图像集成 | ✅ 智能集成 | ❌ 不支持 | ✅ 智能集成 |
| 多格式支持 | ✅ PDF/DOCX/PPTX/XLSX | ❌ 部分支持 | ✅ PDF/DOCX/PPTX/XLSX |

### 🔧 文件变更统计

| 文件 | 变更类型 | 行数变化 | 说明 |
|------|----------|----------|------|
| `bin/darwin/image_extractor.py` | 重大更新 | 439→831行 | 完整功能移植 |
| `bin/darwin/converter.py` | 新增 | +247行 | 全新静态转换器 |
| `bin/darwin/docugenius-cli.sh` | 新增 | +85行 | Shell脚本CLI工具 |
| `bin/darwin/docugenius-cli` | 更新 | 符号链接 | 保持向后兼容 |

---

## [2.3.0] - 2025-08-19

### 新增功能
- 智能图像提取和文档转换功能
- 支持多种文档格式
- 项目级配置管理
- 批量转换优化

### 改进内容
- 优化了用户界面和交互体验
- 增强了错误处理机制
- 改进了文件监控功能

---

## 升级说明

### 从2.3.0升级到2.3.1
- Mac用户将自动获得与Windows用户相同的完整功能
- 无需额外配置，所有新功能开箱即用
- 现有的配置和工作流程保持不变

### 系统要求
- **Windows**: Windows 10或更高版本，Python 3.6+
- **macOS**: macOS 10.14或更高版本，Python 3.6+
- **推荐依赖**: PyMuPDF, python-docx, python-pptx, openpyxl

### 安装建议
为了获得最佳体验，建议安装以下Python包：
```bash
pip install PyMuPDF python-docx python-pptx openpyxl pdfplumber
```

CLI工具会自动检测并安装缺失的依赖，但预先安装可以提供更好的性能。
